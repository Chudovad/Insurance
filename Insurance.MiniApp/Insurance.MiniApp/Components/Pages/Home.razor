@page "/"
@using Insurance.MiniApp.Services
@using Microsoft.AspNetCore.Components
@inject ITokenService TokenService
@inject NavigationManager Navigation

@rendermode InteractiveServer

<PageTitle>Главная страница</PageTitle>

@if (_isLoading)
{
    <MudContainer MaxWidth="MaxWidth.Large" Class="py-4">
        <MudGrid Spacing="3">
            @for (int i = 0; i < 5; i++)
            {
                <MudItem xs="12" sm="6" md="4">
                    <MudCard Elevation="2" Class="profile-card" Style="height: 100%;">
                        <MudStack AlignItems="AlignItems.Center" Spacing="3" Class="pa-6" Style="min-height: 200px; justify-content: center;">
                            <MudSkeleton SkeletonType="SkeletonType.Circle" Width="64px" Height="64px" />
                            <MudSkeleton SkeletonType="SkeletonType.Text" Width="80%" Height="24px" />
                        </MudStack>
                    </MudCard>
                </MudItem>
            }
        </MudGrid>
    </MudContainer>
}
else
{
    <MudContainer MaxWidth="MaxWidth.Large" Class="py-4">
        <MudGrid Spacing="3">
            <!-- Карточка 1: Мои новости -->
            <MudItem xs="12" sm="6" md="4">
                <MudCard Elevation="2" Class="profile-card" Style="height: 100%; cursor: pointer; transition: all 0.2s ease-in-out;"
                         @onclick="@(() => Navigation.NavigateTo("/"))">
                    <MudStack AlignItems="AlignItems.Center" Spacing="3" Class="pa-6" Style="min-height: 200px; justify-content: center;">
                        <MudIcon Icon="@Icons.Material.Filled.Forum" Size="Size.Large" Color="Color.Primary" Style="font-size: 64px;" />
                        <MudText Typo="Typo.body1" Align="Align.Center" Style="color:#2d3748; font-weight: 500;">
                            Мои новости (3)
                        </MudText>
                    </MudStack>
                </MudCard>
            </MudItem>

            <!-- Карточка 2: Мои полисы -->
            <MudItem xs="12" sm="6" md="4">
                <MudCard Elevation="2" Class="profile-card" Style="height: 100%; cursor: pointer; transition: all 0.2s ease-in-out;"
                         @onclick="@(() => Navigation.NavigateTo("/"))">
                    <MudStack AlignItems="AlignItems.Center" Spacing="3" Class="pa-6" Style="min-height: 200px; justify-content: center;">
                        <MudIcon Icon="@Icons.Material.Filled.Assignment" Size="Size.Large" Color="Color.Primary" Style="font-size: 64px;" />
                        <MudText Typo="Typo.body1" Align="Align.Center" Style="color:#2d3748; font-weight: 500;">
                            Мои полисы (договоры)
                        </MudText>
                    </MudStack>
                </MudCard>
            </MudItem>

            <!-- Карточка 3: Оформить полис онлайн -->
            <MudItem xs="12" sm="6" md="4">
                <MudCard Elevation="2" Class="profile-card" Style="height: 100%; cursor: pointer; transition: all 0.2s ease-in-out;"
                         @onclick="@(() => Navigation.NavigateTo("/"))">
                    <MudStack AlignItems="AlignItems.Center" Spacing="3" Class="pa-6" Style="min-height: 200px; justify-content: center;">
                        <MudIcon Icon="@Icons.Material.Filled.EditNote" Size="Size.Large" Color="Color.Primary" Style="font-size: 64px;" />
                        <MudText Typo="Typo.body1" Align="Align.Center" Style="color:#2d3748; font-weight: 500;">
                            Оформить полис (договор) онлайн
                        </MudText>
                    </MudStack>
                </MudCard>
            </MudItem>

            <!-- Карточка 4: Страховые случаи -->
            <MudItem xs="12" sm="6" md="4">
                <MudCard Elevation="2" Class="profile-card" Style="height: 100%; cursor: pointer; transition: all 0.2s ease-in-out;"
                         @onclick="@(() => Navigation.NavigateTo("/"))">
                    <MudStack AlignItems="AlignItems.Center" Spacing="3" Class="pa-6" Style="min-height: 200px; justify-content: center;">
                        <MudIcon Icon="@Icons.Material.Filled.Security" Size="Size.Large" Color="Color.Primary" Style="font-size: 64px;" />
                        <MudText Typo="Typo.body1" Align="Align.Center" Style="color:#2d3748; font-weight: 500;">
                            Страховые случаи
                        </MudText>
                    </MudStack>
                </MudCard>
            </MudItem>

            <!-- Карточка 5: ДМС -->
            <MudItem xs="12" sm="6" md="4">
                <MudCard Elevation="2" Class="profile-card" Style="height: 100%; cursor: pointer; transition: all 0.2s ease-in-out;"
                         @onclick="@(() => Navigation.NavigateTo("/"))">
                    <MudStack AlignItems="AlignItems.Center" Spacing="3" Class="pa-6" Style="min-height: 200px; justify-content: center;">
                        <MudIcon Icon="@Icons.Material.Filled.LocalHospital" Size="Size.Large" Color="Color.Primary" Style="font-size: 64px;" />
                        <MudText Typo="Typo.body1" Align="Align.Center" Style="color:#2d3748; font-weight: 500;">
                            ДМС
                        </MudText>
                    </MudStack>
                </MudCard>
            </MudItem>
        </MudGrid>
    </MudContainer>
}

@code {
    private bool _isLoading = true;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var isAuthenticated = await TokenService.IsAuthenticatedAsync();

            if (!isAuthenticated)
            {
                Navigation.NavigateTo("/login");
                return;
            }

            _isLoading = false;
            StateHasChanged();
        }
    }
}